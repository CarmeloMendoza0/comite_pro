{% extends 'base.html' %}

{% block title %}Reporte de Libro Mayor{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h1 class="text-3xl font-semibold mb-6 text-center text-gray-800">Reporte de Libro Mayor</h1>

    <form method="get" class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
        <div class="flex flex-col">
            <label for="cuenta" class="text-gray-600 font-medium mb-2">Cuenta Contable:</label>
            <select name="cuenta" class="form-select px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring focus:border-blue-500">
                <option value="">Todas las Cuentas</option>
                {% for cuenta in cuentas %}
                    <option value="{{ cuenta.codigo }}" {% if cuenta.codigo == cuenta_seleccionada %}selected{% endif %}>{{ cuenta.codigo }} - {{ cuenta.nombre }}</option>
                {% endfor %}
            </select>
        </div>
    
        <div class="flex flex-col">
            <label for="fecha_inicio" class="text-gray-600 font-medium mb-2">Fecha Inicio:</label>
            <input type="date" name="fecha_inicio" value="{{ fecha_inicio }}" class="form-input px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring focus:border-blue-500">
        </div>
    
        <div class="flex flex-col">
            <label for="fecha_fin" class="text-gray-600 font-medium mb-2">Fecha Fin:</label>
            <input type="date" name="fecha_fin" value="{{ fecha_fin }}" class="form-input px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring focus:border-blue-500">
        </div>
    
        <div class="flex flex-col sm:flex-row items-center w-full sm:w-auto">
            <button type="submit" class="w-full sm:w-auto bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-all">Filtrar</button>
        </div>

        <div class="flex flex-col sm:flex-row items-center w-full sm:w-auto">
            <a href="{% url 'exportar_libro_mayor_pdf' %}?fecha_inicio={{ fecha_inicio }}&fecha_fin={{ fecha_fin }}&cuenta={{ cuenta_seleccionada }}"
            class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-all">
                Exportar a PDF
            </a>
        </div>
    </form>    

    

    <div class="overflow-x-auto">
        <table class="min-w-full border-collapse border border-gray-300">
            <thead>
                <tr class="bg-gray-200">
                    <th class="border px-4 py-2">Cuenta</th>
                    <th class="border px-4 py-2">Descripci√≥n</th>
                    <th class="border px-4 py-2">Saldo Ant.</th>
                    <th class="border px-4 py-2">Debe</th>
                    <th class="border px-4 py-2">Haber</th>
                    <th class="border px-4 py-2">Saldo</th>
                </tr>
            </thead>
            <tbody>
                {% for cuenta in reporte_data %}
                <tr class="bg-gray-100">
                    <!-- Fila inicial para mostrar el saldo anterior de la cuenta -->
                    <td class="border px-4 py-2 font-bold">{{ cuenta.codigo_cuenta }}</td>
                    <td class="border px-4 py-2 font-bold">{{ cuenta.nombre_cuenta }}</td>
                    <td class="border px-4 py-2 text-right font-bold">Q {{ cuenta.saldo_anterior|floatformat:2 }}</td>
                    <td class="border px-4 py-2"></td>
                    <td class="border px-4 py-2"></td>
                    <td class="border px-4 py-2"></td>
                </tr>
                <!-- Mostrar cada movimiento -->
                {% for movimiento in cuenta.movimientos %}
                <tr class="border-t">
                    <td class="border px-4 py-2">{{ movimiento.fecha|date:"d/m/Y" }}</td>
                    <td class="border px-4 py-2">{{ movimiento.descripcion }}</td>
                    <td class="border px-4 py-2 text-right">Q {{ movimiento.saldo_anterior|floatformat:2 }}</td>
                    <td class="border px-4 py-2 text-right">Q {{ movimiento.debe|floatformat:2 }}</td>
                    <td class="border px-4 py-2 text-right">Q {{ movimiento.haber|floatformat:2 }}</td>
                    <td class="border px-4 py-2 text-right">Q {{ movimiento.saldo|floatformat:2 }}</td>
                </tr>
                {% endfor %}
                <!-- Fila de resumen de totales de la cuenta -->
                <tr class="border-t bg-gray-100">
                    <td class="border px-4 py-2 font-bold" colspan="3">Total de {{ cuenta.nombre_cuenta }}</td>
                    <td class="border px-4 py-2 text-right font-bold">Q {{ cuenta.total_debe|floatformat:2 }}</td>
                    <td class="border px-4 py-2 text-right font-bold">Q {{ cuenta.total_haber|floatformat:2 }}</td>
                    <td class="border px-4 py-2 text-right font-bold">Q {{ cuenta.saldo_final|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
